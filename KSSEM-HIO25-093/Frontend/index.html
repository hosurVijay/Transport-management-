<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TransitVision ‚Äî Bus Dashboard</title>

    <style>
      :root {
        --bg: #f1f5f9;
        --card: #ffffff;
        --text: #1e293b;
        --muted: #64748b;

        --primary: #2563eb;
        --primary-dark: #1e40af;

        --success-bg: #d1fae5;
        --success-text: #065f46;

        --danger-bg: #fee2e2;
        --danger-text: #b91c1c;

        --radius: 14px;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: "Inter", Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 28px 40px 10px;
      }

      .app-logo {
        font-size: 34px;
        font-weight: 800;
        color: var(--primary-dark);
        letter-spacing: -0.5px;
      }

      .app-subtitle {
        color: var(--muted);
        font-size: 13px;
        margin-top: 4px;
      }

      /* Navigation button */
      .nav-btn {
        background: var(--primary);
        color: white;
        padding: 12px 20px;
        font-size: 14px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.25);
        transition: 0.25s ease;
      }

      .nav-btn:hover {
        background: var(--primary-dark);
        box-shadow: 0 6px 18px rgba(37, 99, 235, 0.35);
      }

      /* Search bar */
      .search-box {
        max-width: 550px;
        margin: 25px auto;
        padding: 0 20px;
      }

      .search-box input {
        width: 100%;
        padding: 14px 18px;
        font-size: 15px;
        border-radius: var(--radius);
        border: 1px solid #cbd5e1;
        background: white;
      }

      .search-box input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
      }

      /* Bus List */
      .bus-list-wrapper {
        max-width: 650px;
        margin: 0 auto;
        padding: 0 20px 60px;
      }

      .bus-card {
        background: var(--card);
        padding: 18px 20px;
        border-radius: var(--radius);
        margin-bottom: 18px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        transition: 0.25s ease;
        cursor: pointer;
      }

      .bus-card:hover {
        transform: translateY(-4px);
        border-color: var(--primary);
      }

      .bus-number {
        font-size: 22px;
        font-weight: 700;
        color: var(--primary-dark);
      }

      .bus-id {
        font-size: 13px;
        color: var(--muted);
        margin-top: 4px;
        margin-bottom: 10px;
      }

      .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .status-badge {
        padding: 6px 10px;
        font-size: 14px;
        border-radius: 8px;
        font-weight: 600;
      }

      .ready {
        background: var(--success-bg);
        color: var(--success-text);
      }

      .stopped {
        background: var(--danger-bg);
        color: var(--danger-text);
      }

      /* Loading */
      .loading {
        text-align: center;
        font-size: 18px;
        margin-top: 40px;
        color: var(--muted);
      }

      /* Fade animation */
      .fade {
        animation: fadeIn 0.4s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <div class="header fade">
      <div>
        <div class="app-logo">üöç TransitVision</div>
        <div class="app-subtitle">Smart Real-Time Bus Monitoring Dashboard</div>
      </div>

      <!-- NEW BUTTON (ROUTING LINK) -->
      <a href="/KSSEM-HIO25-093/Frontend/allBusTracking.html" class="nav-btn">
        üìç Live Map
      </a>
    </div>

    <div class="search-box fade">
      <input
        id="searchInput"
        placeholder="Search bus by number, ID or status..."
      />
    </div>

    <div id="loading" class="loading fade">Loading buses...</div>

    <div class="bus-list-wrapper" id="busList"></div>

    <script>
      const API_URL = "http://127.0.0.1:3000/api/v1/dashBoard/getAllBus";

      const busList = document.getElementById("busList");
      const loading = document.getElementById("loading");
      const searchInput = document.getElementById("searchInput");

      let busesData = [];

      async function loadBuses() {
        const res = await fetch(API_URL);
        const json = await res.json();

        busesData = json.message || [];
        loading.style.display = "none";
        renderBuses(busesData);
      }

      function renderBuses(list) {
        busList.innerHTML = "";

        list.forEach((bus) => {
          const card = document.createElement("div");
          card.className = "bus-card fade";

          const statusClass =
            bus.status === "readytomove" ? "ready" : "stopped";

          card.innerHTML = `
            <div class="bus-number">${bus.busNumber}</div>
            <div class="bus-id">ID: ${bus._id}</div>

            <div class="row">
              <div style="font-size:14px; color:var(--muted)">
                Route ID: ${bus.busRouteId}
              </div>

              <span class="status-badge ${statusClass}">
                ${bus.status.toUpperCase()}
              </span>
            </div>
          `;

          card.addEventListener("click", () => {
            window.location.href =
              "/KSSEM-HIO25-093/Frontend/index2.html?busId=" + bus._id;
          });

          busList.appendChild(card);
        });
      }

      searchInput.addEventListener("input", () => {
        const term = searchInput.value.toLowerCase();
        const filtered = busesData.filter(
          (bus) =>
            bus.busNumber.toLowerCase().includes(term) ||
            bus._id.toLowerCase().includes(term) ||
            bus.status.toLowerCase().includes(term)
        );
        renderBuses(filtered);
      });

      loadBuses();
    </script>
  </body>
</html>
